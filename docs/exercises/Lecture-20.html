<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Lecture 20 | Your awesome title</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Lecture 20" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/exercises/Lecture-20.html" />
<meta property="og:url" content="http://localhost:4000/exercises/Lecture-20.html" />
<meta property="og:site_name" content="Your awesome title" />
<script type="application/ld+json">
{"headline":"Lecture 20","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@type":"WebPage","url":"http://localhost:4000/exercises/Lecture-20.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Your awesome title" /></head>
<body><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1 id="lecture-20--apr-1st-2020">Lecture 20 – Apr 1st, 2020</h1>

<h2 id="setup">Setup</h2>
<ol>
  <li>Log in to clyde.</li>
  <li><code class="language-plaintext highlighter-rouge">$ cp -r ~steve/ex/linenumbers .</code></li>
</ol>

<h2 id="task">Task</h2>
<ol>
  <li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that it reads a line from <code class="language-plaintext highlighter-rouge">stdin</code> using
<code class="language-plaintext highlighter-rouge">fgets(3)</code> and writes to <code class="language-plaintext highlighter-rouge">stdout</code> using <code class="language-plaintext highlighter-rouge">fprintf(3)</code> (you’ll see why we’re
using <code class="language-plaintext highlighter-rouge">fprintf(3)</code> rather than <code class="language-plaintext highlighter-rouge">printf(3)</code> shortly) except that each line
should be prefixed with its line number as in this example.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./linenumbers &lt; Makefile
1: CC := clang
2: CFLAGS := -Wall -std=c11 -g -fsanitize=address,undefined
3: LDFLAGS := -fsanitize=address,undefined
4:
5: .PHONY: all clean
6:
7: all: linenumbers
8: clean:
9: 	$(RM) linenumbers
</code></pre></div>    </div>
    <p>You may assume a line is no longer than 1024 characters for now.</p>
  </li>
  <li>
    <p>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that if at least one argument is given (so
<code class="language-plaintext highlighter-rouge">argc &gt; 1</code>), the first argument is treated as the file to read rather than
<code class="language-plaintext highlighter-rouge">stdin</code>. I.e., open the file using <code class="language-plaintext highlighter-rouge">fopen(3)</code>. Make sure to handle the case
where <code class="language-plaintext highlighter-rouge">fopen(3)</code> returns <code class="language-plaintext highlighter-rouge">NULL</code> by printing out an appropriate message
using <code class="language-plaintext highlighter-rouge">perror(3)</code> and exiting with <code class="language-plaintext highlighter-rouge">EXIT_FAILURE</code>.</p>

    <p>If no arguments are given, then behave as before, namely reading from
<code class="language-plaintext highlighter-rouge">stdin</code>. You’ll probably want code that looks like</p>
    <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">FILE</span> <span class="o">*</span><span class="n">input</span> <span class="o">=</span> <span class="n">stdin</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">input</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle the error.</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>Here’s an example of the error handling.</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./linenumbers "does not exist"
does not exist: No such file or directory
$ echo $?
1
</code></pre></div>    </div>

    <p>Make sure you <code class="language-plaintext highlighter-rouge">fclose(3)</code> the input when you’re done with it.</p>
  </li>
  <li>
    <p>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> such that if no arguments are given, it behaves as
in part 1. If one argument is given, it behaves as in part 2. If two
arguments are given, the output is written to the file named by the second
argument rather than to <code class="language-plaintext highlighter-rouge">stdout</code>. And if more than two arguments are given,
it prints out a usage message and exits with <code class="language-plaintext highlighter-rouge">EXIT_FAILURE</code>.</p>

    <p>Be careful that you don’t accidentally overwrite a file you care about.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./linenumbers one two three
Usage: ./linenumbers [INPUT [OUTPUT]]
</code></pre></div>    </div>

    <p>Make sure you <code class="language-plaintext highlighter-rouge">fclose(3)</code> the output when you’re done with it.</p>
  </li>
  <li>
    <p>It’s traditional that if <code class="language-plaintext highlighter-rouge">-</code> is passed as a file name for input, then the
input should come from <code class="language-plaintext highlighter-rouge">stdin</code> and if <code class="language-plaintext highlighter-rouge">-</code> is passed as a file name for
output, then the output should go to <code class="language-plaintext highlighter-rouge">stdout</code>. Implement this
functionality, using <code class="language-plaintext highlighter-rouge">strcmp(3)</code> from <code class="language-plaintext highlighter-rouge">string.h</code>.</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo -e "Hello world\nHow are you?" | ./linenumbers - output.txt
$ cat output.txt
1: Hello world
2: How are you?
</code></pre></div>    </div>
  </li>
  <li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> to remove the restriction on line lengths. You can
use <code class="language-plaintext highlighter-rouge">strchr(3)</code> to search for a newline. If it doesn’t exist, output what
you have so far, and then keep reading with <code class="language-plaintext highlighter-rouge">fgets(3)</code> until you reach the
end of the line and output it using <code class="language-plaintext highlighter-rouge">fputs(3)</code>.</li>
  <li>Modify <code class="language-plaintext highlighter-rouge">linenumbers.c</code> one final time to make sure that you handle error
return values (which you really should have been doing all along) from each
of the standard library functions: <code class="language-plaintext highlighter-rouge">fopen(3)</code> and <code class="language-plaintext highlighter-rouge">fgets(3)</code> return <code class="language-plaintext highlighter-rouge">NULL</code>
on error; <code class="language-plaintext highlighter-rouge">fputs(3)</code> and <code class="language-plaintext highlighter-rouge">fclose(3) return </code>EOF<code class="language-plaintext highlighter-rouge"> on error; and </code>fprintf(3)`
returns a negative number on error.</li>
</ol>

      </div>
    </main></body>

</html>
