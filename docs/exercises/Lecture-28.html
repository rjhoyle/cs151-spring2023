<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Lecture 28 | Your awesome title</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Lecture 28" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/exercises/Lecture-28.html" />
<meta property="og:url" content="http://localhost:4000/exercises/Lecture-28.html" />
<meta property="og:site_name" content="Your awesome title" />
<script type="application/ld+json">
{"headline":"Lecture 28","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@type":"WebPage","url":"http://localhost:4000/exercises/Lecture-28.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Your awesome title" /></head>
<body><main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1 id="lecture-28--apr-20th-2020">Lecture 28 – Apr 20th, 2020</h1>

<h2 id="setup">Setup</h2>
<ol>
  <li>Log in to clyde.</li>
  <li>Copy <code class="language-plaintext highlighter-rouge">~steve/ex/sig</code> to your home directory.</li>
</ol>

<h2 id="task">Task</h2>
<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">cd</code> into <code class="language-plaintext highlighter-rouge">sig</code> and look at <code class="language-plaintext highlighter-rouge">block.c</code>. It installs a signal handler for
<code class="language-plaintext highlighter-rouge">SIGINT</code>, masks <code class="language-plaintext highlighter-rouge">SIGINT</code>, sleeps for three seconds, and then unmasks
<code class="language-plaintext highlighter-rouge">SIGINT</code>.</p>

    <p>Run <code class="language-plaintext highlighter-rouge">$ make</code> to compile <code class="language-plaintext highlighter-rouge">block</code>. Run <code class="language-plaintext highlighter-rouge">$ ./block</code> and let it sit until it
exits. Nothing should be printed.</p>

    <p>Run it again, but this time, press <code class="language-plaintext highlighter-rouge">ctrl-C</code> a few times while it is
sleeping. See how many times the message printed from the signal handler
happens. (Note that although we cannot use <code class="language-plaintext highlighter-rouge">printf(3)</code> from a signal
handler, we <em>can</em> use <code class="language-plaintext highlighter-rouge">write(2)</code>.)</p>
  </li>
  <li>
    <p>Now, take a look at <code class="language-plaintext highlighter-rouge">sig.c</code>. Modify the code such that when <code class="language-plaintext highlighter-rouge">ctrl-C</code> is
pressed, <code class="language-plaintext highlighter-rouge">interrupt_count</code> is incremented and when <code class="language-plaintext highlighter-rouge">ctrl-\</code> is pressed
(which sends <code class="language-plaintext highlighter-rouge">SIGQUIT</code>), <code class="language-plaintext highlighter-rouge">done</code> is set to <code class="language-plaintext highlighter-rouge">1</code> to exit the loop. Make sure
to uncomment the loop.</p>

    <p>To do this, you’ll need to use <code class="language-plaintext highlighter-rouge">sigaction(2)</code> twice to install a signal
handler for <code class="language-plaintext highlighter-rouge">SIGINT</code> and <code class="language-plaintext highlighter-rouge">SIGQUIT</code>. You can use the same function or two
different functions. I suggest copying the relevant code from <code class="language-plaintext highlighter-rouge">block.c</code>.</p>
  </li>
  <li>Build and run <code class="language-plaintext highlighter-rouge">./sig</code>. Try pressing <code class="language-plaintext highlighter-rouge">ctrl-C</code> a few times and then press
<code class="language-plaintext highlighter-rouge">ctrl-\</code>. It should print the number of times you pressed <code class="language-plaintext highlighter-rouge">ctrl-C</code>.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">./block</code> in a short loop
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ for i in {1..3}; do ./block; done
</code></pre></div>    </div>
    <p>and press <code class="language-plaintext highlighter-rouge">ctrl-C</code> while it is running.</p>

    <p>You’ll notice that after <code class="language-plaintext highlighter-rouge">SIGINT</code> is unmasked and the program exits, the
<code class="language-plaintext highlighter-rouge">for</code> loop keeps running and <code class="language-plaintext highlighter-rouge">block</code> will be run again. This is because the
signal handler caught and handled the signal so Bash didn’t know that it
had exited due to a signal.</p>
  </li>
  <li>
    <p>Change the <code class="language-plaintext highlighter-rouge">sa_flags</code> to be <code class="language-plaintext highlighter-rouge">SA_RESTART | SA_RESETHAND</code>. This will reset
the signal handler to the default behavior as soon as the signal is
delivered to the handler.</p>

    <p>Add <code class="language-plaintext highlighter-rouge">raise(sig)</code> at the end of the handler to raise the signal again.</p>

    <p>Rerun the loop from part 4 above and press <code class="language-plaintext highlighter-rouge">ctrl-C</code>. This time, it should
exit immediately.</p>
  </li>
</ol>

      </div>
    </main></body>

</html>
